{# Partial pour un groupe de champ avec gestion d'erreur professionnelle #}
{% set hasError = field.vars.errors|length > 0 %}
{% set fieldId = field.vars.id %}
{% set isRequired = field.vars.required %}

<div class="form-field{% if hasError %} form-field--error{% endif %}{% if isRequired %} form-field--required{% endif %}">
  <label for="{{ fieldId }}" class="form-field__label">
    {{ form_label(field, null, {'label_attr': {'class': 'form-field__label-text'}}) }}
    {% if isRequired %}
      <span class="form-field__required" title="Champ obligatoire">*</span>
    {% endif %}
  </label>
  
  <div class="form-field__input-wrapper">
    {% if field.vars.widget_type is defined and field.vars.widget_type == 'choice' %}
      {{ form_widget(field, {'attr': {'class': 'form-field__select'}}) }}
    {% elseif field.vars.block_prefixes[1] == 'textarea' %}
      {{ form_widget(field, {'attr': {'class': 'form-field__textarea'}}) }}
    {% else %}
      {{ form_widget(field, {'attr': {'class': 'form-field__input'}}) }}
    {% endif %}
    
    {% if hasError %}
      <div class="form-field__error-icon">
        <twig:ux:icon name="heroicons:exclamation-circle" />
      </div>
    {% endif %}
  </div>
  
  {% if help is defined and help %}
    <div class="form-field__help">{{ help }}</div>
  {% endif %}
  
  {% include 'partials/_field_errors.html.twig' with {'field': field} %}
</div>

<style>
.form-field {
  margin-bottom: 1.5rem;
}

.form-field__label {
  display: block;
  margin-bottom: 0.5rem;
}

.form-field__label-text {
  font-weight: 500;
  color: #374151;
  font-size: 0.875rem;
  line-height: 1.25rem;
}

.form-field__required {
  color: #dc2626;
  margin-left: 0.25rem;
  font-weight: 600;
}

.form-field__input-wrapper {
  position: relative;
}

.form-field__input,
.form-field__select,
.form-field__textarea {
  width: 100%;
  padding: 0.75rem;
  border: 1px solid #d1d5db;
  border-radius: 0.5rem;
  font-size: 0.875rem;
  line-height: 1.25rem;
  transition: all 0.2s ease-in-out;
  background-color: #ffffff;
}

.form-field__input:focus,
.form-field__select:focus,
.form-field__textarea:focus {
  outline: none;
  border-color: #3b82f6;
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.form-field__input:disabled,
.form-field__select:disabled,
.form-field__textarea:disabled {
  background-color: #f9fafb;
  color: #6b7280;
  cursor: not-allowed;
}

.form-field__textarea {
  min-height: 4rem;
  resize: vertical;
}

.form-field__error-icon {
  position: absolute;
  right: 0.75rem;
  top: 50%;
  transform: translateY(-50%);
  color: #dc2626;
  width: 1.25rem;
  height: 1.25rem;
  pointer-events: none;
}

.form-field__help {
  margin-top: 0.375rem;
  font-size: 0.75rem;
  color: #6b7280;
  line-height: 1.4;
}

/* États spéciaux */
.form-field--required .form-field__label-text::after {
  content: '';
}

.form-field--error .form-field__input,
.form-field--error .form-field__select,
.form-field--error .form-field__textarea {
  border-color: #dc2626;
  box-shadow: 0 0 0 1px #dc2626;
}

.form-field--error .form-field__input:focus,
.form-field--error .form-field__select:focus,
.form-field--error .form-field__textarea:focus {
  border-color: #dc2626;
  box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
}

/* Responsive */
@media (max-width: 768px) {
  .form-field {
    margin-bottom: 1.25rem;
  }
  
  .form-field__input,
  .form-field__select,
  .form-field__textarea {
    padding: 0.625rem;
    font-size: 0.8125rem;
  }
}
</style>
