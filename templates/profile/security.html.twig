{% extends 'base.html.twig' %}

{% block title %}{{ tp('profile_security.page.title', {}, 'profile_security') }}{% endblock %}

{% block body %}

<style>
/* Security Page Specific Styles */
.security__container {
    max-width: 1000px !important;
    margin: 0 auto !important;
    padding: 24px !important;
    background: #f8f9fa !important;
    min-height: 100vh !important;
}

.security__header {
    display: flex !important;
    align-items: center !important;
    gap: 16px !important;
    margin-bottom: 24px !important;
}

.security__back {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    width: 40px !important;
    height: 40px !important;
    border-radius: 8px !important;
    background: #ffffff !important;
    border: 1px solid #e1e8ed !important;
    color: #0066cc !important;
    text-decoration: none !important;
    transition: all 0.2s ease !important;
}

.security__back:hover {
    background: #f8f9fa !important;
    border-color: #0066cc !important;
    color: #0066cc !important;
}

.security__back-icon {
    width: 20px !important;
    height: 20px !important;
}

.security__title {
    font-size: 24px !important;
    font-weight: 700 !important;
    color: #2c3e50 !important;
    margin: 0 !important;
}

.security__grid {
    display: grid !important;
    grid-template-columns: 1fr 1fr !important;
    gap: 24px !important;
}

.security__section {
    background: #ffffff !important;
    border: 1px solid #e1e8ed !important;
    border-radius: 12px !important;
    padding: 24px !important;
}

.security__section--full {
    grid-column: 1 / -1 !important;
}

.security__section-header {
    display: flex !important;
    align-items: center !important;
    justify-content: space-between !important;
    margin-bottom: 20px !important;
}

.security__section-title {
    font-size: 18px !important;
    font-weight: 600 !important;
    color: #2c3e50 !important;
    display: flex !important;
    align-items: center !important;
    gap: 8px !important;
}

.security__section-icon {
    width: 20px !important;
    height: 20px !important;
    color: #0066cc !important;
}

.security__section-status {
    display: flex !important;
    align-items: center !important;
    gap: 6px !important;
    font-size: 12px !important;
    font-weight: 600 !important;
    padding: 4px 8px !important;
    border-radius: 4px !important;
}

.security__section-status--active {
    background: #d4edda !important;
    color: #155724 !important;
}

.security__section-status--inactive {
    background: #f8d7da !important;
    color: #721c24 !important;
}

.security__section-status--warning {
    background: #fff3cd !important;
    color: #856404 !important;
}

.security__section-status-icon {
    width: 12px !important;
    height: 12px !important;
}

.security__item {
    padding: 16px 0 !important;
    border-bottom: 1px solid #f1f3f4 !important;
    display: flex !important;
    align-items: center !important;
    justify-content: space-between !important;
}

.security__item:last-child {
    border-bottom: none !important;
}

.security__item-info {
    flex: 1 !important;
}

.security__item-title {
    font-size: 14px !important;
    font-weight: 600 !important;
    color: #2c3e50 !important;
    margin-bottom: 2px !important;
}

.security__item-desc {
    font-size: 12px !important;
    color: #7f8c8d !important;
}

.security__item-action {
    display: flex !important;
    align-items: center !important;
    gap: 8px !important;
}

.security__btn {
    padding: 8px 12px !important;
    border-radius: 6px !important;
    font-size: 12px !important;
    font-weight: 600 !important;
    cursor: pointer !important;
    transition: all 0.2s ease !important;
    text-decoration: none !important;
    border: none !important;
    display: flex !important;
    align-items: center !important;
    gap: 4px !important;
}

.security__btn--primary {
    background: #0066cc !important;
    color: white !important;
}

.security__btn--primary:hover {
    background: #0052a3 !important;
}

.security__btn--danger {
    background: #dc3545 !important;
    color: white !important;
}

.security__btn--danger:hover {
    background: #c82333 !important;
}

.security__btn--secondary {
    background: #f8f9fa !important;
    color: #0066cc !important;
    border: 1px solid #e1e8ed !important;
}

.security__btn--secondary:hover {
    background: #f1f5f9 !important;
    border-color: #0066cc !important;
}

.security__btn-icon {
    width: 14px !important;
    height: 14px !important;
}

.security__password-form {
    margin-top: 16px !important;
}

.security__form-group {
    margin-bottom: 16px !important;
}

.security__label {
    display: block !important;
    font-size: 12px !important;
    font-weight: 600 !important;
    color: #2c3e50 !important;
    margin-bottom: 4px !important;
    text-transform: uppercase !important;
}

.security__input {
    width: 100% !important;
    padding: 10px 12px !important;
    border: 1px solid #e1e8ed !important;
    border-radius: 6px !important;
    font-size: 14px !important;
    background: #ffffff !important;
    transition: all 0.2s ease !important;
    box-sizing: border-box !important;
}

.security__input:focus {
    outline: none !important;
    border-color: #0066cc !important;
    box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1) !important;
}

.security__password-strength {
    margin-top: 8px !important;
    display: flex !important;
    gap: 4px !important;
}

.security__strength-bar {
    flex: 1 !important;
    height: 4px !important;
    border-radius: 2px !important;
    background: #e1e8ed !important;
}

.security__strength-bar--weak {
    background: #dc3545 !important;
}

.security__strength-bar--medium {
    background: #ffc107 !important;
}

.security__strength-bar--strong {
    background: #28a745 !important;
}

.security__strength-text {
    font-size: 11px !important;
    color: #7f8c8d !important;
    margin-top: 4px !important;
}

.security__device {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
    padding: 16px !important;
    border: 1px solid #e1e8ed !important;
    border-radius: 8px !important;
    margin-bottom: 12px !important;
}

.security__device:last-child {
    margin-bottom: 0 !important;
}

.security__device-icon {
    width: 40px !important;
    height: 40px !important;
    border-radius: 8px !important;
    background: #f8f9fa !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    flex-shrink: 0 !important;
}

.security__device-icon-svg {
    width: 20px !important;
    height: 20px !important;
    color: #0066cc !important;
}

.security__device-info {
    flex: 1 !important;
}

.security__device-name {
    font-size: 14px !important;
    font-weight: 600 !important;
    color: #2c3e50 !important;
    margin-bottom: 2px !important;
}

.security__device-details {
    font-size: 12px !important;
    color: #7f8c8d !important;
}

.security__device-current {
    background: #e3f2fd !important;
    color: #0066cc !important;
    font-size: 10px !important;
    font-weight: 600 !important;
    padding: 2px 6px !important;
    border-radius: 3px !important;
    text-transform: uppercase !important;
}

.security__activity-item {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
    padding: 12px 0 !important;
    border-bottom: 1px solid #f1f3f4 !important;
}

.security__activity-item:last-child {
    border-bottom: none !important;
}

.security__activity-icon {
    width: 32px !important;
    height: 32px !important;
    border-radius: 50% !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    flex-shrink: 0 !important;
}

.security__activity-icon--success {
    background: #d4edda !important;
}

.security__activity-icon--warning {
    background: #fff3cd !important;
}

.security__activity-icon--danger {
    background: #f8d7da !important;
}

.security__activity-icon-svg {
    width: 16px !important;
    height: 16px !important;
}

.security__activity-icon--success .security__activity-icon-svg {
    color: #155724 !important;
}

.security__activity-icon--warning .security__activity-icon-svg {
    color: #856404 !important;
}

.security__activity-icon--danger .security__activity-icon-svg {
    color: #721c24 !important;
}

.security__activity-content {
    flex: 1 !important;
}

.security__activity-text {
    font-size: 14px !important;
    color: #2c3e50 !important;
    margin-bottom: 2px !important;
}

.security__activity-date {
    font-size: 12px !important;
    color: #7f8c8d !important;
}

/* Responsive */
@media (max-width: 768px) {
    .security__grid {
        grid-template-columns: 1fr !important;
    }
    
    .security__device {
        flex-direction: column !important;
        text-align: center !important;
    }
    
    .security__item {
        flex-direction: column !important;
        align-items: flex-start !important;
        gap: 12px !important;
    }
}
</style>

<div class="security__container">
    <!-- Header -->
    <div class="security__header">
        <a href="{{ path('profile_index') }}" class="security__back">
            {{ ux_icon('heroicons:arrow-left', {'class': 'security__back-icon'}) }}
        </a>
        <h1 class="security__title">Sécurité du compte</h1>
    </div>

    <div class="security__grid">
        <!-- Password Section -->
        <div class="security__section">
            <div class="security__section-header">
                <h2 class="security__section-title">
                    {{ ux_icon('heroicons:key', {'class': 'security__section-icon'}) }}
                    Mot de passe
                </h2>
                <div class="security__section-status security__section-status--active">
                    {{ ux_icon('heroicons:check-circle', {'class': 'security__section-status-icon'}) }}
                    Configuré
                </div>
            </div>
            
            <div class="security__item">
                <div class="security__item-info">
                    <div class="security__item-title">Mot de passe actuel</div>
                    <div class="security__item-desc">
                        {% if user.passwordChangedAt %}
                            {% set userTimezone = user.timezone ?: 'Europe/Paris' %}
                            {% set passwordChanged = user.passwordChangedAt|date_modify('0 seconds')|date('U') %}
                            {% set now = 'now'|date('U') %}
                            {% set diff = now - passwordChanged %}
                            {% if diff < 3600 %}
                                Dernière modification il y a {{ (diff / 60)|round }} minute(s)
                            {% elseif diff < 86400 %}
                                Dernière modification il y a {{ (diff / 3600)|round }} heure(s)
                            {% elseif diff < 2592000 %}
                                Dernière modification il y a {{ (diff / 86400)|round }} jour(s)
                            {% else %}
                                Dernière modification le {{ user.passwordChangedAt|date('d/m/Y', userTimezone) }}
                            {% endif %}
                        {% else %}
                            Mot de passe jamais modifié
                        {% endif %}
                    </div>
                </div>
                <div class="security__item-action">
                    <a href="{{ path('profile_security_change_password') }}" class="security__btn security__btn--primary">
                        {{ ux_icon('heroicons:pencil', {'class': 'security__btn-icon'}) }}
                        Modifier
                    </a>
                </div>
            </div>
        </div>

        <!-- Two-Factor Authentication -->
        <div class="security__section">
            <div class="security__section-header">
                <h2 class="security__section-title">
                    {{ ux_icon('heroicons:shield-check', {'class': 'security__section-icon'}) }}
                    Authentification à 2 facteurs
                </h2>
                <div class="security__section-status security__section-status--inactive">
                    {{ ux_icon('heroicons:x-circle', {'class': 'security__section-status-icon'}) }}
                    Désactivée
                </div>
            </div>
            
            <div class="security__item">
                <div class="security__item-info">
                    <div class="security__item-title">Application d'authentification</div>
                    <div class="security__item-desc">Utilisez une app comme Google Authenticator</div>
                </div>
                <div class="security__item-action">
                    <button class="security__btn security__btn--primary">
                        {{ ux_icon('heroicons:plus', {'class': 'security__btn-icon'}) }}
                        Configurer
                    </button>
                </div>
            </div>
            
            <div class="security__item">
                <div class="security__item-info">
                    <div class="security__item-title">SMS de vérification</div>
                    <div class="security__item-desc">Recevez des codes par SMS</div>
                </div>
                <div class="security__item-action">
                    <button class="security__btn security__btn--secondary">
                        {{ ux_icon('heroicons:plus', {'class': 'security__btn-icon'}) }}
                        Ajouter
                    </button>
                </div>
            </div>
        </div>

        <!-- Security Activity -->
        <div class="security__section security__section--full">
            <div class="security__section-header">
                <h2 class="security__section-title">
                    {{ ux_icon('heroicons:shield-exclamation', {'class': 'security__section-icon'}) }}
                    Activité de sécurité récente
                </h2>
            </div>
            
            {% for activity in recentSecurityActivity %}
                <div class="security__activity-item">
                    <div class="security__activity-icon security__activity-icon--{{ activity.status }}">
                        {% if activity.type == 'login_success' %}
                            {{ ux_icon('heroicons:check', {'class': 'security__activity-icon-svg'}) }}
                        {% elseif activity.type == 'login_failed' %}
                            {{ ux_icon('heroicons:exclamation-triangle', {'class': 'security__activity-icon-svg'}) }}
                        {% elseif activity.type == 'password_changed' %}
                            {{ ux_icon('heroicons:key', {'class': 'security__activity-icon-svg'}) }}
                        {% elseif activity.type == 'profile_updated' %}
                            {{ ux_icon('heroicons:user', {'class': 'security__activity-icon-svg'}) }}
                        {% elseif activity.type == 'account_locked' %}
                            {{ ux_icon('heroicons:lock-closed', {'class': 'security__activity-icon-svg'}) }}
                        {% else %}
                            {{ ux_icon('heroicons:information-circle', {'class': 'security__activity-icon-svg'}) }}
                        {% endif %}
                    </div>
                    <div class="security__activity-content">
                        <div class="security__activity-text">{{ activity.description }}</div>
                        <div class="security__activity-date">
                            {% if activity.created_at|date('Y-m-d') == "now"|date('Y-m-d') %}
                                Aujourd'hui à {{ activity.created_at|date('H:i') }}
                            {% elseif activity.created_at|date('Y-m-d') == "now"|date_modify("-1 day")|date('Y-m-d') %}
                                Hier à {{ activity.created_at|date('H:i') }}
                            {% else %}
                                {{ activity.created_at|date('d/m/Y') }} à {{ activity.created_at|date('H:i') }}
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% else %}
                <div class="security__activity-item">
                    <div class="security__activity-icon security__activity-icon--success">
                        {{ ux_icon('heroicons:information-circle', {'class': 'security__activity-icon-svg'}) }}
                    </div>
                    <div class="security__activity-content">
                        <div class="security__activity-text">Aucune activité de sécurité récente</div>
                        <div class="security__activity-date">Votre compte est sécurisé</div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
</div>

{% endblock %}
