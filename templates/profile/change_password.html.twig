{% extends 'base.html.twig' %}

{% block title %}{{ tp('profile_change_password.page.title', {}, 'profile_change_password') }}{% endblock %}

{% block body %}

<style>
/* Change Password Page Specific Styles */
.change-password__container {
    max-width: 600px !important;
    margin: 0 auto !important;
    padding: 24px !important;
    background: #f8f9fa !important;
    min-height: 100vh !important;
}

.change-password__header {
    display: flex !important;
    align-items: center !important;
    gap: 16px !important;
    margin-bottom: 24px !important;
}

.change-password__back {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    width: 40px !important;
    height: 40px !important;
    border-radius: 8px !important;
    background: #ffffff !important;
    border: 1px solid #e1e8ed !important;
    color: #0066cc !important;
    text-decoration: none !important;
    transition: all 0.2s ease !important;
}

.change-password__back:hover {
    background: #f8f9fa !important;
    border-color: #0066cc !important;
    color: #0066cc !important;
}

.change-password__back-icon {
    width: 20px !important;
    height: 20px !important;
}

.change-password__title {
    font-size: 24px !important;
    font-weight: 700 !important;
    color: #2c3e50 !important;
    margin: 0 !important;
}

.change-password__form {
    background: #ffffff !important;
    border: 1px solid #e1e8ed !important;
    border-radius: 12px !important;
    padding: 32px !important;
}

.change-password__form-title {
    font-size: 18px !important;
    font-weight: 600 !important;
    color: #2c3e50 !important;
    margin-bottom: 24px !important;
    display: flex !important;
    align-items: center !important;
    gap: 8px !important;
}

.change-password__form-icon {
    width: 20px !important;
    height: 20px !important;
    color: #0066cc !important;
}

.change-password__info {
    background: #e3f2fd !important;
    border: 1px solid #90caf9 !important;
    border-radius: 8px !important;
    padding: 16px !important;
    margin-bottom: 24px !important;
    font-size: 14px !important;
    color: #1565c0 !important;
}

.change-password__form-group {
    margin-bottom: 20px !important;
}

.change-password__label {
    display: block !important;
    font-size: 14px !important;
    font-weight: 600 !important;
    color: #2c3e50 !important;
    margin-bottom: 8px !important;
}

.change-password__input {
    width: 100% !important;
    padding: 12px 16px !important;
    border: 1px solid #e1e8ed !important;
    border-radius: 8px !important;
    font-size: 16px !important;
    background: #ffffff !important;
    transition: all 0.2s ease !important;
    box-sizing: border-box !important;
}

.change-password__input:focus {
    outline: none !important;
    border-color: #0066cc !important;
    box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1) !important;
}

.change-password__password-strength {
    margin-top: 12px !important;
    display: flex !important;
    gap: 6px !important;
}

.change-password__strength-bar {
    flex: 1 !important;
    height: 6px !important;
    border-radius: 3px !important;
    background: #e1e8ed !important;
    transition: background-color 0.3s ease !important;
}

.change-password__strength-bar--weak {
    background: #dc3545 !important;
}

.change-password__strength-bar--medium {
    background: #ffc107 !important;
}

.change-password__strength-bar--strong {
    background: #28a745 !important;
}

.change-password__strength-text {
    font-size: 12px !important;
    color: #7f8c8d !important;
    margin-top: 8px !important;
    font-weight: 500 !important;
}

.change-password__requirements {
    margin-top: 12px !important;
    padding: 16px !important;
    background: #f8f9fa !important;
    border-radius: 6px !important;
    border: 1px solid #e9ecef !important;
}

.change-password__requirements-title {
    font-size: 13px !important;
    font-weight: 600 !important;
    color: #495057 !important;
    margin-bottom: 8px !important;
}

.change-password__requirements-list {
    list-style: none !important;
    padding: 0 !important;
    margin: 0 !important;
}

.change-password__requirements-item {
    font-size: 12px !important;
    color: #6c757d !important;
    margin-bottom: 4px !important;
    display: flex !important;
    align-items: center !important;
    gap: 8px !important;
}

.change-password__requirements-item::before {
    content: "•" !important;
    color: #0066cc !important;
    font-weight: bold !important;
}

.change-password__buttons {
    display: flex !important;
    gap: 12px !important;
    margin-top: 32px !important;
}

.change-password__btn {
    padding: 12px 24px !important;
    border-radius: 8px !important;
    font-size: 14px !important;
    font-weight: 600 !important;
    cursor: pointer !important;
    transition: all 0.2s ease !important;
    text-decoration: none !important;
    border: none !important;
    display: flex !important;
    align-items: center !important;
    gap: 8px !important;
    justify-content: center !important;
}

.change-password__btn--primary {
    background: #0066cc !important;
    color: white !important;
    flex: 1 !important;
}

.change-password__btn--primary:hover {
    background: #0052a3 !important;
}

.change-password__btn--secondary {
    background: #f8f9fa !important;
    color: #0066cc !important;
    border: 1px solid #e1e8ed !important;
}

.change-password__btn--secondary:hover {
    background: #f1f5f9 !important;
    border-color: #0066cc !important;
    color: #0066cc !important;
}

.change-password__btn-icon {
    width: 16px !important;
    height: 16px !important;
}

/* Error styles */
.change-password__errors {
    background: #f8d7da !important;
    border: 1px solid #f5c6cb !important;
    color: #721c24 !important;
    padding: 12px 16px !important;
    border-radius: 6px !important;
    margin-bottom: 16px !important;
    font-size: 14px !important;
}

.change-password__errors ul {
    margin: 0 !important;
    padding-left: 20px !important;
}

/* Responsive */
@media (max-width: 768px) {
    .change-password__container {
        padding: 16px !important;
    }
    
    .change-password__form {
        padding: 24px !important;
    }
    
    .change-password__buttons {
        flex-direction: column !important;
    }
}
</style>

<div class="change-password__container">
    <!-- Header -->
    <div class="change-password__header">
        <a href="{{ path('profile_security') }}" class="change-password__back">
            {{ ux_icon('heroicons:arrow-left', {'class': 'change-password__back-icon'}) }}
        </a>
        <h1 class="change-password__title">Changer le mot de passe</h1>
    </div>

    <!-- Form -->
    <div class="change-password__form">
        <h2 class="change-password__form-title">
            {{ ux_icon('heroicons:key', {'class': 'change-password__form-icon'}) }}
            Nouveau mot de passe
        </h2>
        
        <div class="change-password__info">
            {{ ux_icon('heroicons:information-circle', {'class': 'change-password__form-icon'}) }}
            Choisissez un mot de passe fort pour protéger votre compte. Il sera utilisé pour toutes vos connexions futures.
        </div>

        {{ form_start(passwordForm) }}
            <!-- Nouveau mot de passe -->
            <div class="change-password__form-group">
                {{ form_label(passwordForm.plainPassword.first, 'Nouveau mot de passe', {'attr': {'class': 'change-password__label'}}) }}
                {{ form_widget(passwordForm.plainPassword.first, {'attr': {'class': 'change-password__input', 'id': 'newPassword'}}) }}
                
                {% if form_errors(passwordForm.plainPassword.first) %}
                    <div class="change-password__errors">
                        {{ form_errors(passwordForm.plainPassword.first) }}
                    </div>
                {% endif %}
                
                <div class="change-password__password-strength">
                    <div class="change-password__strength-bar"></div>
                    <div class="change-password__strength-bar"></div>
                    <div class="change-password__strength-bar"></div>
                    <div class="change-password__strength-bar"></div>
                    <div class="change-password__strength-bar"></div>
                </div>
                <div class="change-password__strength-text">Force du mot de passe</div>
                
                <div class="change-password__requirements">
                    <div class="change-password__requirements-title">Exigences du mot de passe :</div>
                    <ul class="change-password__requirements-list">
                        <li class="change-password__requirements-item">Au moins 12 caractères</li>
                        <li class="change-password__requirements-item">Lettres minuscules et majuscules</li>
                        <li class="change-password__requirements-item">Au moins un chiffre</li>
                        <li class="change-password__requirements-item">Au moins un caractère spécial</li>
                    </ul>
                </div>
            </div>
            
            <!-- Confirmer le mot de passe -->
            <div class="change-password__form-group">
                {{ form_label(passwordForm.plainPassword.second, 'Confirmer le nouveau mot de passe', {'attr': {'class': 'change-password__label'}}) }}
                {{ form_widget(passwordForm.plainPassword.second, {'attr': {'class': 'change-password__input'}}) }}
                
                {% if form_errors(passwordForm.plainPassword.second) %}
                    <div class="change-password__errors">
                        {{ form_errors(passwordForm.plainPassword.second) }}
                    </div>
                {% endif %}
            </div>
            
            <!-- Erreurs générales du formulaire -->
            {% if form_errors(passwordForm) %}
                <div class="change-password__errors">
                    {{ form_errors(passwordForm) }}
                </div>
            {% endif %}
            
            <!-- Boutons -->
            <div class="change-password__buttons">
                <button type="submit" class="change-password__btn change-password__btn--primary">
                    {{ ux_icon('heroicons:check', {'class': 'change-password__btn-icon'}) }}
                    {{ tp('profile_change_password.actions.save', {}, 'profile_change_password') }}
                </button>
                <a href="{{ path('profile_security') }}" class="change-password__btn change-password__btn--secondary">
                    {{ ux_icon('heroicons:x-mark', {'class': 'change-password__btn-icon'}) }}
                    {{ tp('profile_change_password.actions.cancel', {}, 'profile_change_password') }}
                </a>
            </div>
        {{ form_end(passwordForm) }}
    </div>
</div>

<script>
// Indicateur de force du mot de passe
document.getElementById('newPassword')?.addEventListener('input', function(e) {
    const password = e.target.value;
    const strengthBars = document.querySelectorAll('.change-password__strength-bar');
    const strengthText = document.querySelector('.change-password__strength-text');
    
    let strength = 0;
    if (password.length >= 12) strength++;
    if (/[a-z]/.test(password)) strength++;
    if (/[A-Z]/.test(password)) strength++;
    if (/[0-9]/.test(password)) strength++;
    if (/[^A-Za-z0-9]/.test(password)) strength++;
    
    strengthBars.forEach((bar, index) => {
        bar.className = 'change-password__strength-bar';
        if (index < strength) {
            if (strength <= 2) bar.classList.add('change-password__strength-bar--weak');
            else if (strength <= 3) bar.classList.add('change-password__strength-bar--medium');
            else bar.classList.add('change-password__strength-bar--strong');
        }
    });
    
    const strengthLabels = ['Très faible', 'Faible', 'Moyen', 'Fort', 'Très fort'];
    strengthText.textContent = `Force du mot de passe: ${strengthLabels[strength - 1] || 'Aucun'}`;
});
</script>

{% endblock %}
